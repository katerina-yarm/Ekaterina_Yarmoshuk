<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href="modal.css" rel="stylesheet" >
    <title>Document</title>
    <style>
        a{
            text-decoration: none;
            color: rgb(117, 116, 116);
        }
        a:hover{
            color:honeydew;
        }
        body{
            padding: 10px;
        }
        h2{
            padding-bottom: 20px;
        }
        .form {
            border-width: .5px;
            border-style: solid;
            border-radius: 5px;
            padding: 20px;
            width: 560px;
            border-color: rgb(192, 189, 189);
            margin-left: 40px;
        }
        .buttons{
            width: 186px;
            margin-left: auto;
            margin-right: 0;
        }
        .btn-outline-secondary{
            width: 186px;
        }
        .col-form-label{
            width: 90px;
        }
        .mod{
            width: 81px;
        }
        #cart{
            position: relative;
            background-color: #6c757d3b;
            width: 30%;
            padding: 10px 20px;
            border: solid rgb(133, 132, 132) 1px;
            border-radius:5px;
            height: 100%;
            position: fixed;
            top: 0;
            right: 0;
        }
        #cart h4 {
            padding-bottom: 20px;
        }
        #cart_list{
            padding: 0;
        }
        #cart li{
            list-style: none;
            padding: 5px;
            border-bottom: rgb(133, 132, 132) solid 1px;
        }
        #cart .price{
            float: right;
        }
        #cart div p{
            float: right;
        }
    </style>
</head>
<body>
    <div id=cart>
        <h4>Shopping Cart</h4>
        <p><em>Drop here to add to cart</em></p>
        <ul id=cart_list></ul>
        <div>
            <p><strong>Total sum: </strong><span id=total_sum> 0.00 </span> $</p>
        </div>
    </div>
    
    <button type="button" class="btn btn-outline-secondary" style="margin: 40px" onclick="showPhoneCards ()">Show list of phones</button>
    <form name="form" class="form">
        <h2>Product card filling in form</h2>
        <div class="mb-3 row">
            <label class="col-sm-2 col-form-label">Model</label>
            <div class="col-sm-10">
              <input class="form-control" name="model" placeholder="Samsung Galaxy A21s">
            </div>
          </div>
          <div class="mb-3 row">
            <label class="col-sm-2 col-form-label">Id</label>
            <div class="col-sm-10">
              <input class="form-control" name="id" placeholder="4">
            </div>
          </div>
          <div class="mb-3 row">
            <label class="col-sm-2 col-form-label">ImgUrl</label>
            <div class="col-sm-10">
              <input class="form-control" name="imgUrl" placeholder="red.jpg">
            </div>
          </div>
          <div class="mb-3 row">
            <label class="col-sm-2 col-form-label">Color</label>
            <div class="col-sm-10">
              <input class="form-control" name="color">
            </div>
          </div>
          <div class="mb-3 row">
            <label class="col-sm-2 col-form-label">Sale</label>
            <div class="col-sm-10">
              <input class="form-control" name="sale" placeholder="true or false">
            </div>
          </div>
          <div class="mb-3 row">
            <label class="col-sm-2 col-form-label">Price</label>
            <div class="col-sm-10">
              <input class="form-control" name="price" placeholder="only numbers">
            </div>
          </div>
          <div class="mb-3 row">
            <label class="col-sm-2 col-form-label">Description</label>
            <div class="col-sm-10">
                <textarea class="form-control" aria-label="With textarea" name="description"></textarea>
            </div>
          </div>
          <div class="buttons">
            <button type="button" class="btn btn-outline-secondary" onclick="getValue()">Add</button>
          </div>
    </form>
    <div id=app style="display: flex; margin: 20px;"></div>

    <div id="openModal" class="modalDialog">
        <div>
            <a href="#close" title="Закрыть" class="close">X</a>
            <div id=modal></div>
        </div>
    </div>

     

  <script> 
        const app = document.getElementById('app');
        const modal = document.getElementById('modal');

        class Phone {
            constructor () {
            }
       
        }

        //создаем хранилище для моделей телефонов
        const phones = new Phone ();
        phones.id1 = { 
        model: "Samsung Galaxy A21s 64GB",
        id: 1,
        imgUrl:"blue.jpg",
        color: "синий",
        description: "Плавные линии корпуса позволяют легко и комфортно держать смартфон в руке.",
        price: 650,
        sale: false 
        };
        phones.id2 = { 
        model: "Samsung Galaxy A21s 64GB",
        id: 2,
        imgUrl:"red.jpg",
        color: "красный",
        description: "Выбирай один из уникальных оттенков Черного, Синего или Красного цветов, чтобы подчеркнуть свой неповторимый стиль.",
        price: 580,
        sale: true 
        };
        phones.id3 = { 
        model: "Samsung Galaxy A12 64GB",
        id: 3,
        imgUrl:"grey.jpeg",
        color: "черный",
        description: "Яркая глянцевая панель Galaxy A12 приковывает взгляд.",
        price: 580,
        sale: true 
        };

        //прорисовываем интерфейс отображения всех элементов, которые находятся в хранилище phones
        function render (){
            let html = '';
            for (let key in phones){
            html+= `<div class="card" id="${phones[key].id}" style="width: 20%; margin: 20px;" draggable="true">
                            <img src="${phones[key].imgUrl}" id="${phones[key].id}" class="card-img-top" alt="..." style="height: 400px;">
                            <div class="card-body" style="position: relative;">
                                <h5 class="card-title">${phones[key].model}</h5>
                                <p class="card-text">${phones[key].color}</p>
                                <p class="card-text">${phones[key].price} $</p>
                                <p class="card-text">${phones[key].description}</p>`
                                html+= phones[key].sale ? "<p style='color:red; margin-bottom: 120px;'> SALE </p>":"<p></p>"
                                html+= `<div style="position:absolute; bottom:5px"> 
                                    <button data-phoneid=${phones[key].id} type="button" class="btn-del btn btn-outline-secondary" style="width: 100 px; margin-bottom:5px">Delete</button>
                                    <button type="button" class=" btn btn-outline-secondary" style="width: 100 px; margin-bottom:5px"><a class='btn-modal' href="#openModal" onclick='showModalWindow(${phones[key].id})'>Update</a></button>
                                </div>
                            </div>
                        </div>`
            }
            return html;
        }
    
        // отображает все карточки телефонов + позволяет работать с ними (т.е. внутри функция для удаления карточек)
        function showPhoneCards () {
            app.innerHTML=render();

            let buttons = document.querySelectorAll('.btn-del'); //выбирает в массив все кнопки класса '.btn-del'
            buttons.forEach ((btn,indx) => {// назначим обработчик по кнопке, он будет вызван когда кликнут на любую кнопку
                btn.addEventListener('click', function(e){
                    //e.target ссылается на кликнутый элемент
                    let buttonId = e.target.dataset.phoneid;
                    for (let key in phones){
                        if (phones[key].id == buttonId){
                            delete phones[key];
                            showPhoneCards ();
                        }
                    }
                }); 
            })
        }

        //заменила getElementById на другой способ (где form-значение атрибута name тэга form, ["id"]-значение атрибута name тэга input)
        function getValue() {
            phones[`id${form.elements["id"].value}`] = {
                model: form.elements["model"].value,
                id:parseInt(form.elements["id"].value),
                imgUrl: form.elements["imgUrl"].value,
                color: form.elements["color"].value,
                description: form.elements["description"].value,
                price: form.elements["price"].value,
                sale: form.elements["sale"].value
            };
            showPhoneCards();
        }
        
        //                                              РАБОТАЕМ С МОДАЛЬНЫМ ОКНОМ

        let modalButtons = document.getElementsByClassName ('btn-modal');//выбирает в массив все ссылки класса btn-modal

        //функция render для модального окна
        function modalRender(id){
            let modalHTML ="";
                modalHTML += `<form name="modal-form" class="modal-form">  
                        <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Information about "${phones[`id${id}`].model}"</h5>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3 row">
                                <label class="col-sm-2 col-form-label mod">Model</label>
                                <div class="col-sm-10">
                                <input class="form-control" id="model" value="${phones[`id${id}`].model}">
                                </div>
                            </div>
                            <div class="mb-3 row">
                                <label class="col-sm-2 col-form-label mod">Id</label>
                                <div class="col-sm-10">
                                <input class="form-control" id="id" value="${phones[`id${id}`].id}" readonly>
                                </div>
                            </div>
                            <div class="mb-3 row">
                                <label class="col-sm-2 col-form-label mod">ImgUrl</label>
                                <div class="col-sm-10">
                                <input class="form-control" id="imgUrl" value="${phones[`id${id}`].imgUrl}">
                                </div>
                            </div>
                            <div class="mb-3 row">
                                <label class="col-sm-2 col-form-label mod">Color</label>
                                <div class="col-sm-10">
                                <input class="form-control" id="color" value="${phones[`id${id}`].color}">
                                </div>
                            </div>
                            <div class="mb-3 row">
                                <label class="col-sm-2 col-form-label mod">Sale</label>
                                <div class="col-sm-10">
                                <input class="form-control" id="sale" value="${phones[`id${id}`].sale}">
                                </div>
                            </div>
                            <div class="mb-3 row">
                                <label class="col-sm-2 col-form-label mod">Price</label>
                                <div class="col-sm-10">
                                <input class="form-control" id="price" value="${phones[`id${id}`].price}">
                                </div>
                            </div>
                            <div class="mb-3 row">
                                <label class="col-sm-2 col-form-label mod">Description</label>
                                <div class="col-sm-10">
                                    <input class="form-control" aria-label="With textarea" id="description" value="${phones[`id${id}`].description}">
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" onclick='getModalValue()'>Save changes</button>
                        </div></form>`;
                return modalHTML;
        }
        
        //забираем данные из модальной формы и вносим изменения в карточку
        function getModalValue() {
            let model = document.getElementById('model').value;
            let id = document.getElementById('id').value;
            let imgUrl = document.getElementById('imgUrl').value;
            let color = document.getElementById('color').value;
            let description = document.getElementById('description').value;
            let price = document.getElementById('price').value;
            let sale = document.getElementById('sale').value;

            phones[`id${id}`].model=model;
            phones[`id${id}`].id=id;
            phones[`id${id}`].imgUrl=imgUrl;
            phones[`id${id}`].color=color;
            phones[`id${id}`].description=description;
            phones[`id${id}`].price=price;
            phones[`id${id}`].sale=sale; 

            alert ('Изменения успешно внесены, модальное окно может быть закрыто!')

            showPhoneCards();
        }

        //показываем модальное окно с данными для выбранного телефона
        function showModalWindow (modalButtonId) {
            modal.innerHTML = modalRender(modalButtonId);
        }

        //                                                   РАБОТАЕМ С КОРЗИНОЙ

        const cart = document.getElementById("cart");
        const totalPrice = document.getElementById("total_sum");
        let itemId = null;
        let priceCount = 0;

        //событие возникает у перетаскиваемого элемента,когда пользователь нажал левую кнопку мыши и начал движение
        //т.е. мы забираем id элемента
        document.addEventListener("dragstart", function (e) {
            console.log ("id: " + e.target.id);
            itemId = e.target.id;
        });

        document.addEventListener("dragover", function (e) {
            e.preventDefault();
        });

        //событие возникает у элемента приемника,когда в нем находится перетаскиваемый элемент и левая кнопка мыши отпускается
        cart.addEventListener("drop", function (e) {
            const itemBlock = document.createElement("li");
            const title = document.createElement("span");
            const quantity = document.createElement("span");
            const price = document.createElement("span");
            price.innerHTML = phones[`id${itemId}`].price + "$";
            title.innerHTML = phones[`id${itemId}`].model;
            itemBlock.appendChild(title);
            itemBlock.appendChild(price).setAttribute('class','price');
            itemBlock.appendChild(quantity).setAttribute('class','quantity');
            document.getElementById('cart_list').appendChild(itemBlock);
            priceCount += phones[`id${itemId}`].price;
            totalPrice.innerHTML = priceCount;
        });

        

  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</body>
</html>